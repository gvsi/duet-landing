---

---

<section class="agent-showcase" aria-label="AI Agent Chat" data-agent-section>
    <!-- Editorial Divider -->
    <div class="editorial-divider">
        <span class="feature-label">FEATURE 03 â€” INTELLIGENCE</span>
    </div>

    <div class="agent-container">
        <header class="agent-header">
            <h2 class="agent-title">The Intelligence Desk</h2>
            <p class="agent-subtitle">
                A proactive agent that works across your inbox, calendar, and
                contacts.
                <br class="hidden md:block" />
                Ask challenging questions. Get instant answers.
            </p>
        </header>

        <div class="chat-mockup" aria-hidden="true">
            <!-- REMOVED: Particles and ambient glow -->

            <div class="window-wrapper">
                <!-- Clean Frame (No luminous glow) -->

                <div class="window">
                    <div class="window-header">
                        <div class="traffic-lights">
                            <span class="dot dot-red"></span>
                            <span class="dot dot-yellow"></span>
                            <span class="dot dot-green"></span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">Duet Agent</span>
                            <span class="agent-state">
                                <span class="state-dot"></span>
                                Online
                            </span>
                        </div>
                        <div class="header-spacer"></div>
                    </div>

                    <div class="chat-body">
                        <!-- User Message -->
                        <div class="message user-message">
                            <div class="message-content">
                                Can you find the Stripe invoice sent by Accounting?
                            </div>
                        </div>

                        <!-- Processing Indicator -->
                        <div class="processing-state">
                            <div class="processing-line"></div>
                            <span class="processing-text"
                                >Searching inbox...</span
                            >
                        </div>

                        <!-- Agent Response (Pre-rendered for JS to animate if needed, but keeping structure clean) -->
                        <div class="message agent-message">
                            <div class="message-content">
                                <div class="agent-response-header">
                                    <svg
                                        class="check-icon"
                                        width="14"
                                        height="14"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        stroke="currentColor"
                                        stroke-width="3"
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                    >
                                        <polyline points="20 6 9 17 4 12"
                                        ></polyline>
                                    </svg>
                                    <span class="typing-text typing-line-1">Found 2 emails from Stripe</span>
                                </div>
                                <p>
                                    <span class="typing-text typing-line-2">I found the receipt for <strong>$29.00 USD</strong> from Oct 24th.</span>
                                </p>

                                <div class="attachment-card">
                                    <div class="file-icon">
                                        <svg
                                            width="16"
                                            height="16"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="2"
                                        >
                                            <path
                                                d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                                            ></path>
                                            <polyline points="14 2 14 8 20 8"
                                            ></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"
                                            ></line>
                                            <line x1="16" y1="17" x2="8" y2="17"
                                            ></line>
                                            <polyline points="10 9 9 9 8 9"
                                            ></polyline>
                                        </svg>
                                    </div>
                                    <div class="file-info">
                                        <span class="file-name"
                                            >invoice_oct24.pdf</span
                                        >
                                        <span class="file-size">142 KB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="suggestions-container">
                        <button class="suggestion-chip" data-action="draft"
                            >Draft a reply</button
                        >
                        <button class="suggestion-chip" data-action="calendar"
                            >Find time to meet</button
                        >
                    </div>

                    <div class="input-area">
                        <div class="input-placeholder">Ask anything...</div>
                        <div class="send-btn">
                            <svg
                                width="16"
                                height="16"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                            >
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"
                                ></polygon>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .agent-showcase {
        position: relative;
        padding: 0 24px 120px;
        overflow: hidden;
    }

    .editorial-divider {
        max-width: 1200px;
        margin: 0 auto 80px;
        border-top: 1px solid var(--duet-border-editorial);
        padding-top: 24px;
        display: flex;
        justify-content: flex-start;
    }

    .feature-label {
        font-family: var(--font-sans);
        font-size: 11px;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--duet-muted);
    }

    .agent-container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr;
        gap: 64px;
    }

    @media (min-width: 1024px) {
        .agent-container {
            grid-template-columns: 350px 1fr;
            align-items: start;
        }
    }

    .agent-header {
        text-align: left;
        position: sticky;
        top: 120px;
    }

    .agent-title {
        margin: 0 0 24px;
        font-family: var(--font-serif);
        font-size: 42px;
        font-weight: 500;
        line-height: 1.1;
        letter-spacing: -0.02em;
        text-wrap: balance;
        color: var(--prose-heading);
    }

    .agent-subtitle {
        margin: 0;
        font-family: var(--font-sans);
        font-size: 16px;
        font-weight: 400;
        line-height: 1.7;
        color: var(--duet-muted);
        max-width: 320px;
    }

    /* Mockup */
    .chat-mockup {
        position: relative;
        display: flex;
        justify-content: center;
        perspective: 1000px;
    }

    .window-wrapper {
        position: relative;
        width: 100%;
        max-width: 600px;
        z-index: 1;
    }

    /* Window */
    .window {
        background: var(--mockup-window-bg);
        border-radius: 16px;
        border: 1px solid var(--mockup-border);
        box-shadow: var(--mockup-shadow);
        overflow: hidden;
        transform: translateY(20px);
        opacity: 0;
        transition:
            transform 1s cubic-bezier(0.2, 0.8, 0.2, 1),
            opacity 1s ease;
    }

    @media (max-width: 1199px) {
        .window {
            border-radius: 12px;
        }
    }

    @media (max-width: 809px) {
        .window {
            border-radius: 10px;
        }
    }

    .in-view .window {
        transform: translateY(0);
        opacity: 1;
    }

    /* Window Header */
    .window-header {
        padding: 12px 16px;
        border-bottom: 1px solid var(--mockup-border);
        background: transparent;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .traffic-lights {
        display: flex;
        gap: 8px;
    }

    .dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        opacity: 0.6;
    }

    .dot-red {
        background: #ff5f57;
    }
    .dot-yellow {
        background: #ffbd2e;
    }
    .dot-green {
        background: #28c840;
    }

    .agent-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        line-height: 1.2;
    }

    .agent-name {
        font-size: 12px;
        font-weight: 500;
        color: var(--duet-fg);
    }

    .agent-state {
        font-size: 10px;
        color: var(--duet-muted);
        display: flex;
        align-items: center;
        gap: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .state-dot {
        width: 4px;
        height: 4px;
        background: #22c55e;
        border-radius: 50%;
    }

    .header-spacer {
        width: 44px;
    }

    /* Chat Body */
    .chat-body {
        padding: 24px;
        height: 380px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 24px;
        scroll-behavior: smooth;
        scrollbar-width: thin;
    }

    .chat-body::-webkit-scrollbar {
        width: 4px;
    }
    .chat-body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .chat-body :global(.message) {
        max-width: 85%;
        padding: 14px 18px;
        font-size: 14px;
        line-height: 1.6;
        opacity: 0;
        transform: translateY(10px);
        animation-fill-mode: forwards;
    }

    .chat-body :global(.user-message) {
        align-self: flex-end;
        background: var(--email-bg-1); /* Neutral Grey */
        border-radius: 12px;
        color: var(--duet-fg);
        animation: msgSlideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) 0.5s forwards;
    }

    .chat-body :global(.agent-message) {
        align-self: flex-start;
        /* No background for agent, just text or subtle border? Let's go subtle border */
        background: transparent;
        border-left: 2px solid #2dd4bf; /* Teal accent line */
        padding-left: 16px;
        padding-top: 0;
        padding-bottom: 0;
        border-radius: 0;
        color: var(--duet-fg);
        animation: msgSlideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) 2.5s forwards;
    }

    .chat-body :global(.agent-response-header) {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        font-weight: 600;
        color: #2dd4bf; /* Teal */
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 8px;
    }

    /* Attachment */
    .chat-body :global(.attachment-card) {
        margin-top: 16px;
        background: var(--email-bg-1);
        border: 1px solid var(--mockup-border);
        border-radius: 10px;
        padding: 12px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .chat-body :global(.file-icon) {
        color: var(--duet-muted);
    }

    .chat-body :global(.file-name) {
        color: var(--duet-fg);
        font-size: 13px;
        font-weight: 500;
        font-family: var(--font-serif);
    }
    .chat-body :global(.file-size) {
        color: var(--duet-muted);
        font-size: 11px;
    }

    /* Processing State - Minimalist */
    .chat-body :global(.processing-state) {
        align-self: flex-start;
        display: flex;
        align-items: center;
        gap: 12px;
        padding-left: 16px; /* Match agent message padding */
        opacity: 0;
        animation:
            processShow 1.5s ease 1.1s forwards,
            processHide 0.5s ease 2.4s forwards;
    }

    .chat-body :global(.processing-line) {
        width: 1px;
        height: 16px;
        background: #2dd4bf;
        opacity: 0.5;
        animation: lineBlink 1s ease-in-out infinite;
    }

    .chat-body :global(.processing-text) {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--duet-muted);
    }

    /* Input Area */
    .input-area {
        margin-top: auto;
        padding: 16px 20px;
        border-top: 1px solid var(--mockup-border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: transparent;
    }

    .input-placeholder {
        font-family: var(--font-serif);
        font-style: italic;
        font-size: 14px;
        color: var(--duet-muted);
    }

    .send-btn {
        color: var(--duet-muted);
        transition: color 0.2s;
    }
    .send-btn:hover {
        color: var(--duet-fg);
    }

    /* Animations */
    @keyframes msgSlideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes processShow {
        from {
            opacity: 0;
            transform: translateY(5px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes processHide {
        to {
            opacity: 0;
            transform: translateY(-5px);
            height: 0;
            margin: 0;
            overflow: hidden;
        }
    }

    @keyframes lineBlink {
        0%,
        100% {
            opacity: 0.2;
        }
        50% {
            opacity: 1;
        }
    }

    /* Suggestions */
    .agent-showcase :global(.suggestions-container) {
        padding: 0 24px 16px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        opacity: 0;
        animation: fadeIn 0.5s ease 3.5s forwards;
    }

    .agent-showcase :global(.suggestion-chip) {
        background: transparent;
        border: 1px solid var(--mockup-border);
        border-radius: 8px;
        padding: 6px 14px;
        font-size: 12px;
        color: var(--duet-muted);
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .agent-showcase :global(.suggestion-chip:hover) {
        border-color: #2dd4bf;
        color: #2dd4bf;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Responsiveness */
    @media (max-width: 768px) {
        .agent-title {
            font-size: 32px;
        }
        .window {
            transform: translateY(20px);
        }
        .chat-body {
            padding: 16px;
            min-height: 300px;
        }
        .suggestions-container {
            padding: 0 16px 12px;
        }
    }

    /* Dynamic Content Styles */
    :global(.action-btn-primary) {
        background: #e4e4e7;
        color: #000;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
    }
    :global(.action-btn-secondary) {
        background: transparent;
        color: var(--duet-fg);
        border: 1px solid var(--duet-border);
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        cursor: pointer;
    }
    :global(.calendar-slot) {
        background: transparent;
        border: 1px solid var(--duet-border);
        padding: 12px;
        border-radius: 10px;
        display: flex;
        justify-content: space-between;
        color: var(--duet-fg);
        cursor: pointer;
        width: 100%;
        transition: border-color 0.2s;
    }
    :global(.calendar-slot:hover) {
        border-color: #2dd4bf;
    }
    :global(.slot-time) {
        font-family: var(--font-serif);
        font-size: 14px;
    }
    :global(.slot-duration) {
        font-size: 12px;
        color: var(--duet-muted);
    }

    /* Refactored JS inline classes */
    :global(.draft-preview-card) {
        margin-top: 12px;
        background: var(--email-bg-1);
        border-left: 2px solid var(--duet-border);
        padding: 12px 16px;
    }
    :global(.draft-preview-header) {
        font-size: 10px;
        color: var(--duet-muted);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    :global(.draft-preview-body) {
        font-family: "Domine Variable", serif;
        font-size: 14px;
        color: var(--duet-fg);
        line-height: 1.6;
    }

    /* Typing animation for agent response */
    .typing-text {
        background: linear-gradient(90deg, currentColor 50%, transparent 50%);
        background-size: 200% 100%;
        background-position: 100% 0;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: agentTypingReveal var(--typing-duration) steps(var(--typing-steps), end) var(--typing-delay) forwards;
        animation-play-state: paused;
    }

    .typing-line-1 {
        --typing-delay: 2.6s;
        --typing-duration: 0.6s;
        --typing-steps: 25;
    }

    .typing-line-2 {
        --typing-delay: 3.2s;
        --typing-duration: 1s;
        --typing-steps: 40;
    }

    .typing-line-3 {
        --typing-delay: 4.2s;
        --typing-duration: 0.7s;
        --typing-steps: 30;
    }

    .in-view .typing-text {
        animation-play-state: running;
    }

    @keyframes agentTypingReveal {
        to {
            background-position: 0% 0;
        }
    }

    /* Dynamic typing for JS-generated responses - must be global for dynamic content */
    :global(.typing-text-dynamic) {
        background: linear-gradient(90deg, var(--duet-fg) 50%, transparent 50%);
        background-size: 200% 100%;
        background-position: 100% 0;
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: agentTypingReveal var(--typing-duration, 0.8s) steps(var(--typing-steps, 30), end) var(--typing-delay, 0s) forwards;
    }

    :global(.typing-dynamic-1) {
        --typing-delay: 0s;
        --typing-duration: 0.7s;
        --typing-steps: 35;
    }

    :global(.typing-dynamic-2) {
        --typing-delay: 0.7s;
        --typing-duration: 0.5s;
        --typing-steps: 25;
    }

    :global(.typing-dynamic-3) {
        --typing-delay: 1.2s;
        --typing-duration: 0.3s;
        --typing-steps: 10;
    }

    :global(.typing-dynamic-4) {
        --typing-delay: 1.5s;
        --typing-duration: 1s;
        --typing-steps: 50;
    }

    :global(.typing-dynamic-5) {
        --typing-delay: 2.5s;
        --typing-duration: 0.8s;
        --typing-steps: 40;
    }

    :global(.typing-dynamic-6) {
        --typing-delay: 3.3s;
        --typing-duration: 0.2s;
        --typing-steps: 6;
    }

    @media (prefers-reduced-motion: reduce) {
        .typing-text,
        :global(.typing-text-dynamic) {
            animation: none !important;
            background: none !important;
            -webkit-text-fill-color: var(--duet-fg) !important;
        }

        .window,
        .message,
        .processing-state,
        .suggestions-container {
            animation: none !important;
            opacity: 1 !important;
            transform: none !important;
        }
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const section = document.querySelector("[data-agent-section]");
        if (!section) return;

        // Intersection Observer logic
        if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
            section.classList.add("in-view");
        } else {
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("in-view");
                            observer.unobserve(entry.target);
                        }
                    });
                },
                { threshold: 0.35 },
            );
            observer.observe(section);
        }

        // Interaction Logic
        const chatBody = section.querySelector(".chat-body");
        const suggestionsContainer = section.querySelector(
            ".suggestions-container",
        );

        // Helper to process user action
        const handleUserAction = (
            action: string,
            label: string,
            containerToRemove?: HTMLElement,
        ) => {
            if (!chatBody) return;

            // 1. Hide suggestions container
            if (containerToRemove) {
                containerToRemove.style.display = "none";
            } else if (suggestionsContainer) {
                (suggestionsContainer as HTMLElement).style.display = "none";
            }

            // 2. Add User Message
            const userMsg = document.createElement("div");
            userMsg.className = "message user-message";
            userMsg.innerHTML = `<div class="message-content">${label}</div>`;
            userMsg.style.animationDelay = "0s";
            chatBody.appendChild(userMsg);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 3. Show Processing
            const processing = document.createElement("div");
            processing.className = "processing-state";
            processing.style.animation = "none";
            processing.style.opacity = "1";

            let processingText = "Processing...";
            if (action === "draft") processingText = "Generating draft...";
            if (action === "calendar")
                processingText = "Checking availability...";

            processing.innerHTML = `
                <div class="processing-line" style="animation: lineBlink 1s ease-in-out infinite"></div>
                <span class="processing-text">${processingText}</span>
            `;
            chatBody.appendChild(processing);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 4. Agent Response
            setTimeout(() => {
                processing.remove();
                const agentMsg = document.createElement("div");
                agentMsg.className = "message agent-message";
                agentMsg.style.animationDelay = "0s";

                let responseHTML = "";

                if (action === "draft") {
                    responseHTML = `
                        <div class="message-content">
                            <p style="margin-bottom: 12px; font-size: 13px;"><span class="typing-text-dynamic typing-dynamic-1">Here's a draft reply to Accounting:</span></p>
                            <div class="draft-preview-card">
                                <div class="draft-preview-header"><span class="typing-text-dynamic typing-dynamic-2">Draft: accounting@company.com</span></div>
                                <div class="draft-preview-body">
                                    <span class="typing-text-dynamic typing-dynamic-3">Hi Team,</span><br><br>
                                    <span class="typing-text-dynamic typing-dynamic-4">Please find attached the Stripe invoice for October ($29.00).</span><br>
                                    <span class="typing-text-dynamic typing-dynamic-5">Let me know if you need anything else.</span><br><br>
                                    <span class="typing-text-dynamic typing-dynamic-6">Best,</span>
                                </div>
                            </div>
                            <div style="margin-top: 16px; display: flex; gap: 8px;">
                                <button class="action-btn-primary">Send Email</button>
                                <button class="action-btn-secondary">Edit</button>
                            </div>
                        </div>
                    `;
                } else if (action === "calendar") {
                    responseHTML = `
                        <div class="message-content">
                            <p style="margin-bottom: 12px; font-size: 13px;"><span class="typing-text-dynamic typing-dynamic-1">You have 3 slots open tomorrow:</span></p>
                            <div class="calendar-options" style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
                                <button class="calendar-slot">
                                    <span class="slot-time">9:30 AM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                                <button class="calendar-slot">
                                    <span class="slot-time">2:00 PM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                                <button class="calendar-slot">
                                    <span class="slot-time">4:30 PM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                            </div>
                        </div>
                    `;
                }

                agentMsg.innerHTML = responseHTML;
                chatBody.appendChild(agentMsg);
                chatBody.scrollTop = chatBody.scrollHeight;

                // 5. Trigger Third Turn
                const alreadyServed =
                    section.getAttribute("data-served-options") || "";

                if (!alreadyServed.includes(action)) {
                    section.setAttribute(
                        "data-served-options",
                        alreadyServed + action + ",",
                    );

                    let nextAction = "";
                    let nextLabel = "";

                    if (
                        action === "draft" &&
                        !alreadyServed.includes("calendar")
                    ) {
                        nextAction = "calendar";
                        nextLabel = "Also schedule a follow-up?";
                    } else if (
                        action === "calendar" &&
                        !alreadyServed.includes("draft")
                    ) {
                        nextAction = "draft";
                        nextLabel = "Also draft the reply?";
                    }

                    if (nextAction) {
                        setTimeout(() => {
                            const newContainer = document.createElement("div");
                            newContainer.className = "suggestions-container";
                            newContainer.style.padding = "0";
                            newContainer.style.marginTop = "10px";
                            newContainer.style.opacity = "0";
                            newContainer.style.animation =
                                "fadeIn 0.5s ease forwards";

                            const nextChip = document.createElement("button");
                            nextChip.className = "suggestion-chip";
                            nextChip.textContent = nextLabel;
                            nextChip.onclick = () =>
                                handleUserAction(
                                    nextAction,
                                    nextLabel,
                                    newContainer,
                                );

                            newContainer.appendChild(nextChip);
                            chatBody.appendChild(newContainer);
                            chatBody.scrollTop = chatBody.scrollHeight;
                        }, 800);
                    }
                }
            }, 1000);
        };

        const chips = section.querySelectorAll(".suggestion-chip");
        chips.forEach((chip) => {
            chip.addEventListener("click", (e) => {
                const target = e.currentTarget as HTMLElement;
                const action = target.getAttribute("data-action");
                if (action) handleUserAction(action, target.textContent || "");
            });
        });
    });
</script>
