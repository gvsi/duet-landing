---
---

<section
    class="agent-showcase"
    aria-label="AI Agent Chat"
    data-agent-section
>
    <div class="agent-container">
        <header class="agent-header">
            <h2 class="agent-title">Ask your inbox anything</h2>
            <p class="agent-subtitle">
                A true proactive agent. Chat with Duet to find answers across your emails,
                draft complex replies, or manage your calendar instantly.
            </p>
        </header>

        <div class="chat-mockup" aria-hidden="true">
            <div class="ambient-glow"></div>
            
            <!-- Floating Particles -->
            <div class="particles">
                <span class="particle p1"></span>
                <span class="particle p2"></span>
                <span class="particle p3"></span>
            </div>

            <div class="window-wrapper">
                <div class="luminous-frame">
                    <div class="luminous-border"></div>
                    <div class="luminous-glow"></div>
                    <div class="luminous-corner luminous-corner-tl"></div>
                    <div class="luminous-corner luminous-corner-br"></div>
                </div>

                <div class="window">
                    <div class="window-header">
                        <div class="traffic-lights">
                            <span class="dot dot-red"></span>
                            <span class="dot dot-yellow"></span>
                            <span class="dot dot-green"></span>
                        </div>
                        <div class="agent-info">
                            <span class="agent-name">Duet Agent</span>
                            <span class="agent-state">
                                <span class="state-dot"></span>
                                Online
                            </span>
                        </div>
                        <div class="header-spacer"></div>
                    </div>

                    <div class="chat-body">
                        <!-- User Message -->
                        <div class="message user-message">
                            <div class="message-content">
                                Can you find the invoice from Stripe for last month and draft a reply to Accounting?
                            </div>
                        </div>

                        <!-- Processing Indicator -->
                        <div class="processing-state">
                            <div class="processing-line"></div>
                            <span class="processing-text">Searching inbox...</span>
                        </div>

                        <!-- Agent Response -->
                        <div class="message agent-message">
                            <div class="message-content">
                                <div class="agent-response-header">
                                    <svg class="check-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    <span>Found 2 emails from Stripe</span>
                                </div>
                                <p>I found the receipt for <strong>$29.00 USD</strong> from Oct 24th.</p>
                                <p class="mt-2 text-white/60">Drafting reply to accounting@...</p>
                                
                                <div class="attachment-card">
                                    <div class="file-icon">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                            <polyline points="14 2 14 8 20 8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                            <polyline points="10 9 9 9 8 9"></polyline>
                                        </svg>
                                    </div>
                                    <div class="file-info">
                                        <span class="file-name">invoice_oct24.pdf</span>
                                        <span class="file-size">142 KB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="suggestions-container">
                        <button class="suggestion-chip" data-action="draft">Yes, show me the draft</button>
                        <button class="suggestion-chip" data-action="calendar">When can I meet them?</button>
                    </div>

                    <div class="input-area">
                        <div class="input-placeholder">Reply to Duet...</div>
                        <div class="send-btn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .agent-showcase {
        --accent-primary: #4530ea;
        --accent-secondary: #2dd4bf;
        --accent-glow: #74c2ff;
        
        padding: 96px 24px 120px;
        position: relative;
        overflow: hidden;
    }

    .agent-container {
        max-width: 900px;
        margin: 0 auto;
    }

    .agent-header {
        text-align: center;
        margin-bottom: 64px;
        position: relative;
        z-index: 2;
    }

    .agent-title {
        font-family: "Domine Variable", ui-serif, Georgia, serif;
        font-size: 48px;
        font-weight: 500;
        line-height: 1.1;
        letter-spacing: -0.02em;
        color: #ffffff;
        margin: 0 0 20px;
        text-wrap: balance;
    }

    .agent-subtitle {
        font-family: "Manrope Variable", ui-sans-serif, system-ui, sans-serif;
        font-size: 18px;
        color: #a1a1aa;
        max-width: 580px;
        margin: 0 auto;
        line-height: 1.6;
        text-wrap: pretty;
    }

    /* Mockup */
    .chat-mockup {
        position: relative;
        display: flex;
        justify-content: center;
        perspective: 1000px;
    }

    .ambient-glow {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 800px;
        height: 600px;
        background: radial-gradient(
            circle at center,
            rgba(69, 48, 234, 0.15) 0%,
            rgba(45, 212, 191, 0.05) 40%,
            transparent 70%
        );
        filter: blur(80px);
        opacity: 0;
        transition: opacity 1.5s ease;
        pointer-events: none;
    }

    .in-view .ambient-glow {
        opacity: 1;
    }

    .window-wrapper {
        position: relative;
        width: 100%;
        max-width: 540px;
        z-index: 1;
    }

    /* Window */
    .window {
        background: rgba(18, 18, 22, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 
            0 24px 48px -12px rgba(0, 0, 0, 0.5),
            0 0 0 1px rgba(255, 255, 255, 0.05) inset;
        overflow: hidden;
        transform: translateY(40px) rotateX(2deg);
        opacity: 0;
        transition: 
            transform 1s cubic-bezier(0.2, 0.8, 0.2, 1),
            opacity 1s ease;
    }

    .in-view .window {
        transform: translateY(0) rotateX(0);
        opacity: 1;
    }

    /* Luminous Frame (matches other showcases) */
    .luminous-frame {
        position: absolute;
        inset: -12px;
        border-radius: 32px; /* Window 20px + 12px inset */
        pointer-events: none;
        z-index: 0;
        opacity: 0;
        transition: opacity 1s ease 0.3s;
    }

    .in-view .luminous-frame {
        opacity: 1;
    }

    .luminous-border {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 1px;
        background: linear-gradient(135deg, rgba(69,48,234,0.5), rgba(45,212,191,0.5));
        -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;
        opacity: 0.3;
    }

    .luminous-glow {
        position: absolute;
        inset: -6px;
        border-radius: 38px; /* Frame 32px + 6px */
        box-shadow: 0 0 40px rgba(69, 48, 234, 0.15);
    }

    .luminous-corner {
        position: absolute;
        width: 80px;
        height: 80px;
        border-radius: inherit;
        opacity: 0.5;
        will-change: opacity;
        animation: cornerPulse 5s ease-in-out infinite;
    }

    .luminous-corner-tl {
        top: -4px;
        left: -4px;
        background: radial-gradient(
            ellipse at 0% 0%,
            rgba(69, 48, 234, 0.6) 0%,
            transparent 70%
        );
        animation-delay: 0s;
    }

    .luminous-corner-br {
        bottom: -4px;
        right: -4px;
        background: radial-gradient(
            ellipse at 100% 100%,
            rgba(69, 48, 234, 0.6) 0%,
            transparent 70%
        );
        animation-delay: 2.5s;
    }

    @keyframes cornerPulse {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 0.8; }
    }

    /* Window Header */
    .window-header {
        padding: 16px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        background: rgba(255, 255, 255, 0.02);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .traffic-lights {
        display: flex;
        gap: 8px;
    }

    .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .dot-red { background: #ff5f57; }
    .dot-yellow { background: #ffbd2e; }
    .dot-green { background: #28c840; }

    .agent-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        line-height: 1.2;
    }

    .agent-name {
        font-size: 13px;
        font-weight: 500;
        color: #e4e4e7;
    }

    .agent-state {
        font-size: 11px;
        color: rgba(255, 255, 255, 0.5);
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .state-dot {
        width: 6px;
        height: 6px;
        background: #22c55e;
        border-radius: 50%;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.4);
    }
    
    .header-spacer { width: 44px; } /* Balancing the flex layout */

    .window-actions {
        display: flex;
        gap: 6px;
    }

    .action-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
    }

    /* Chat Body */
    .chat-body {
        padding: 24px;
        height: 380px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 20px;
        scroll-behavior: smooth;
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
    }
    
    .chat-body::-webkit-scrollbar {
        width: 6px;
    }
    .chat-body::-webkit-scrollbar-track {
        background: transparent;
    }
    .chat-body::-webkit-scrollbar-thumb {
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
    }

    .chat-body :global(.message) {
        max-width: 85%;
        padding: 14px 18px;
        font-size: 14px;
        line-height: 1.5;
        opacity: 0;
        transform: translateY(10px);
        animation-fill-mode: forwards;
    }

    .chat-body :global(.user-message) {
        align-self: flex-end;
        background: rgba(69, 48, 234, 0.2);
        border: 1px solid rgba(69, 48, 234, 0.3);
        border-radius: 16px 16px 4px 16px;
        color: #fff;
        animation: msgSlideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) 0.5s forwards;
    }

    .chat-body :global(.agent-message) {
        align-self: flex-start;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 16px 16px 16px 4px;
        color: #e4e4e7;
        animation: msgSlideIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) 2.5s forwards;
    }

    .chat-body :global(.agent-response-header) {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        font-weight: 600;
        color: var(--accent-secondary);
        margin-bottom: 8px;
    }

    /* Attachment */
    .chat-body :global(.attachment-card) {
        margin-top: 12px;
        background: rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        padding: 10px;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .chat-body :global(.file-icon) {
        color: var(--accent-glow);
        opacity: 0.8;
    }

    .chat-body :global(.file-info) {
        display: flex;
        flex-direction: column;
        font-size: 12px;
    }

    .chat-body :global(.file-name) { color: #fff; font-weight: 500; }
    .chat-body :global(.file-size) { color: rgba(255, 255, 255, 0.4); font-size: 11px; }

    /* Processing State */
    .chat-body :global(.processing-state) {
        align-self: flex-start;
        display: flex;
        align-items: center;
        gap: 12px;
        padding-left: 4px;
        opacity: 0;
        animation: processShow 1.5s ease 1.1s forwards, processHide 0.5s ease 2.4s forwards;
    }

    .chat-body :global(.processing-line) {
        width: 2px;
        height: 16px;
        background: var(--accent-secondary);
        box-shadow: 0 0 10px var(--accent-secondary);
        animation: lineScan 1s ease-in-out infinite;
    }

    .chat-body :global(.processing-text) {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.5);
    }

    /* Input Area */
    .input-area {
        margin-top: auto;
        padding: 16px 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(0, 0, 0, 0.2);
    }

    .input-placeholder {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.3);
    }

    .send-btn {
        width: 32px;
        height: 32px;
        border-radius: 8px;
        display: grid;
        place-items: center;
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.6);
    }

    /* Animations */
    @keyframes corePulse {
        0%, 100% { transform: scale(1); opacity: 1; }
        50% { transform: scale(0.85); opacity: 0.8; }
    }

    @keyframes glowPulse {
        0% { transform: scale(1); opacity: 0.4; }
        100% { transform: scale(1.5); opacity: 0.2; }
    }

    @keyframes ringExpand {
        0% { transform: scale(0.8); opacity: 0.6; border-color: rgba(255,255,255,0.4); }
        100% { transform: scale(2); opacity: 0; border-color: rgba(255,255,255,0); }
    }

    @keyframes msgSlideIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes processShow {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes processHide {
        to { opacity: 0; transform: translateY(-5px); height: 0; margin: 0; overflow: hidden; }
    }

    @keyframes lineScan {
        0%, 100% { height: 8px; opacity: 0.5; }
        50% { height: 18px; opacity: 1; }
    }

    /* Particles */
    .particles { pointer-events: none; position: absolute; inset: 0; }
    .particle {
        position: absolute;
        width: 4px;
        height: 4px;
        background: var(--accent-secondary);
        border-radius: 50%;
        opacity: 0;
        filter: blur(2px);
    }

    .in-view .p1 { animation: float 4s ease-in-out infinite 0.5s; top: 20%; left: 20%; }
    .in-view .p2 { animation: float 5s ease-in-out infinite 1.2s; top: 60%; right: 15%; }
    .in-view .p3 { animation: float 6s ease-in-out infinite 2s; bottom: 30%; left: 30%; }

    @keyframes float {
        0%, 100% { transform: translateY(0); opacity: 0; }
        50% { transform: translateY(-20px); opacity: 0.4; }
    }

    /* Suggestions */
    .agent-showcase :global(.suggestions-container) {
        padding: 0 24px 16px;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        opacity: 0;
        animation: fadeIn 0.5s ease 3.5s forwards;
    }

    .agent-showcase :global(.suggestion-chip) {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 8px 16px;
        font-size: 13px;
        color: #e4e4e7;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .agent-showcase :global(.suggestion-chip:hover) {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .agent-showcase :global(.suggestion-chip:active) {
        transform: translateY(0);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* Responsiveness */
    @media (max-width: 768px) {
        .agent-title { font-size: 36px; }
        .window { transform: translateY(20px); }
        .chat-body { padding: 16px; min-height: 240px; }
        .suggestions-container { padding: 0 16px 12px; }
    }

    /* Dynamic Content Styles (injected via JS) */
    :global(.action-btn-primary) {
        background: var(--accent-primary);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
    }
    :global(.action-btn-secondary) {
        background: rgba(255,255,255,0.1);
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
    }
    :global(.calendar-slot) {
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.1);
        padding: 10px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        color: #fff;
        cursor: pointer;
        width: 100%;
        transition: background 0.2s;
    }
    :global(.calendar-slot:hover) {
        background: rgba(255,255,255,0.1);
    }
    :global(.slot-time) { font-weight: 600; font-size: 13px; }
    :global(.slot-duration) { font-size: 12px; color: rgba(255,255,255,0.5); }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const section = document.querySelector("[data-agent-section]");
        if (!section) return;

        // Intersection Observer logic
        if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
            section.classList.add("in-view");
        } else {
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("in-view");
                            observer.unobserve(entry.target);
                        }
                    });
                },
                { threshold: 0.35 },
            );
            observer.observe(section);
        }

        // Interaction Logic
        const chatBody = section.querySelector(".chat-body");
        const suggestionsContainer = section.querySelector(".suggestions-container");

        // Helper to process user action
        const handleUserAction = (action: string, label: string, containerToRemove?: HTMLElement) => {
            if (!chatBody) return;

            // 1. Hide suggestions container
            if (containerToRemove) {
                containerToRemove.style.display = "none";
            } else if (suggestionsContainer) {
                (suggestionsContainer as HTMLElement).style.display = "none";
            }

            // 2. Add User Message
            const userMsg = document.createElement("div");
            userMsg.className = "message user-message";
            userMsg.innerHTML = `<div class="message-content">${label}</div>`;
            userMsg.style.animationDelay = "0s";
            chatBody.appendChild(userMsg);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 3. Show Processing
            const processing = document.createElement("div");
            processing.className = "processing-state";
            processing.style.animation = "none";
            processing.style.opacity = "1";
            
            let processingText = "Processing...";
            if (action === "draft") processingText = "Generating draft...";
            if (action === "calendar") processingText = "Checking availability...";

            processing.innerHTML = `
                <div class="processing-line" style="animation: lineScan 1s ease-in-out infinite"></div>
                <span class="processing-text">${processingText}</span>
            `;
            chatBody.appendChild(processing);
            chatBody.scrollTop = chatBody.scrollHeight;

            // 4. Agent Response
            setTimeout(() => {
                processing.remove();
                const agentMsg = document.createElement("div");
                agentMsg.className = "message agent-message";
                agentMsg.style.animationDelay = "0s";

                let responseHTML = "";

                if (action === "draft") {
                    responseHTML = `
                        <div class="message-content">
                            <p>Here is a draft to Accounting. I've attached the invoice as requested.</p>
                            <div class="draft-preview-card" style="margin-top: 12px; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 16px; border: 1px solid rgba(255,255,255,0.1);">
                                <div style="font-size: 11px; color: rgba(255,255,255,0.5); margin-bottom: 8px;">To: accounting@company.com</div>
                                <div style="font-size: 13px; color: #fff; line-height: 1.5;">
                                    Hi Team,<br><br>
                                    Please find attached the Stripe invoice for October ($29.00).<br>
                                    Let me know if you need anything else.<br><br>
                                    Best,
                                </div>
                            </div>
                            <div style="margin-top: 12px; display: flex; gap: 8px;">
                                <button class="action-btn-primary">Send Email</button>
                                <button class="action-btn-secondary">Edit</button>
                            </div>
                        </div>
                    `;
                } else if (action === "calendar") {
                    responseHTML = `
                        <div class="message-content">
                            <p>You have 3 slots open tomorrow that work for everyone:</p>
                            <div class="calendar-options" style="margin-top: 12px; display: flex; flex-direction: column; gap: 8px;">
                                <button class="calendar-slot">
                                    <span class="slot-time">9:30 AM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                                <button class="calendar-slot">
                                    <span class="slot-time">2:00 PM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                                <button class="calendar-slot">
                                    <span class="slot-time">4:30 PM</span>
                                    <span class="slot-duration">30 min</span>
                                </button>
                            </div>
                        </div>
                    `;
                }

                agentMsg.innerHTML = responseHTML;
                chatBody.appendChild(agentMsg);
                chatBody.scrollTop = chatBody.scrollHeight;

                // 5. Trigger Third Turn (Offer the unselected option)
                const alreadyServed = section.getAttribute('data-served-options') || "";
                
                if (!alreadyServed.includes(action)) {
                     // Mark this action as served
                     section.setAttribute('data-served-options', alreadyServed + action + ",");
                     
                     // Determine the next suggestion
                     let nextAction = "";
                     let nextLabel = "";
                     
                     if (action === "draft" && !alreadyServed.includes("calendar")) {
                         nextAction = "calendar";
                         nextLabel = "Also schedule a follow-up?";
                     } else if (action === "calendar" && !alreadyServed.includes("draft")) {
                         nextAction = "draft";
                         nextLabel = "Also draft the reply?";
                     }

                     if (nextAction) {
                         setTimeout(() => {
                             const newContainer = document.createElement("div");
                             newContainer.className = "suggestions-container";
                             // Override/Add styles for inline flow
                             newContainer.style.padding = "0"; 
                             newContainer.style.marginTop = "10px";
                             newContainer.style.opacity = "0";
                             newContainer.style.animation = "fadeIn 0.5s ease forwards";
                             
                             const nextChip = document.createElement("button");
                             nextChip.className = "suggestion-chip";
                             nextChip.textContent = nextLabel;
                             nextChip.onclick = () => handleUserAction(nextAction, nextLabel, newContainer);
                             
                             newContainer.appendChild(nextChip);
                             chatBody.appendChild(newContainer);
                             chatBody.scrollTop = chatBody.scrollHeight;
                         }, 800);
                     }
                }

            }, 1500);
        };

        // Attach listeners to initial chips
        const initialChips = section.querySelectorAll(".suggestion-chip");
        initialChips.forEach((chip) => {
            chip.addEventListener("click", () => {
                const action = (chip as HTMLElement).dataset.action;
                const label = chip.textContent || "";
                handleUserAction(action || "", label);
            });
        });
    });
</script>
</script>
