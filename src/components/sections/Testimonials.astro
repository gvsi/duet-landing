---
import { HOME_LOGOS, type HomeLogo } from "./logosData"

type Testimonial = {
    name: string
    title: string
    quote: string
    logoName: HomeLogo["name"]
    avatarKey?: string
}

const avatarPath = (key: string, size: 64 | 96 | 128) =>
    `/avatars/testimonials/${key}-${size}.jpg`

const avatarSrcSet = (key: string) =>
    `${avatarPath(key, 64)} 64w, ${avatarPath(key, 96)} 96w, ${avatarPath(
        key,
        128
    )} 128w`

const TESTIMONIALS: Testimonial[] = [
    {
        name: "Francesca T.",
        title: "Freelancer",
        quote: "Worth every penny. The time I save on email pays for Duet Mail 10x over. Can't imagine working without it now.",
        logoName: "Airtable",
        avatarKey: "francesca",
    },
    {
        name: "Michael R.",
        title: "Sales Executive",
        quote: "The instant summaries of long email threads are pure magic, and so user-friendly. My clients think I'm superhuman.",
        logoName: "Upwork",
        avatarKey: "michael",
    },
    {
        name: "Johnny S.",
        title: "Entrepreneur",
        quote: "Was skeptical of artificial intelligence use for my emails. Now, it's like having a brilliant executive assistant. Can't imagine going back.",
        logoName: "Fiverr",
        avatarKey: "johnny",
    },
    {
        name: "Jennifer L.",
        title: "Consultant",
        quote: "As a consultant, every minute counts. Duet Mail doesn't just save me time—it makes my email communication sharper.",
        logoName: "Ahrefs",
        avatarKey: "jennifer",
    },
    {
        name: "Sarah T.",
        title: "Marketing Director",
        quote: "Finally, an AI mail assistant that actually learns how I write. The instant replies are so spot-on, my team thought I was working at midnight.",
        logoName: "Wise",
        avatarKey: "sarah",
    },
]

const repeatedTestimonials = [...TESTIMONIALS, ...TESTIMONIALS]
const logoByName = new Map(HOME_LOGOS.map((logo) => [logo.name, logo] as const))
---

<section id="testimonials" class="home-testimonials" aria-label="Testimonials">
    <div class="mx-auto max-w-6xl px-6 md:px-10">
        <header class="home-testimonials__header">
            <p class="home-testimonials__pill">Testimonials</p>
            <h2 class="home-testimonials__title">Loved by busy professionals</h2>
            <p class="home-testimonials__subtitle">
                Real people. Real inbox wins.
            </p>
        </header>

        <div class="home-testimonials__ticker" aria-label="Scrolling testimonials">
            <ul class="home-testimonials__track" role="list">
                {repeatedTestimonials.map((testimonial, index) => {
                    const logo = logoByName.get(testimonial.logoName)
                    const isDuplicate = index >= TESTIMONIALS.length
                    const initial = testimonial.name.trim().slice(0, 1).toUpperCase()

                    return (
                        <li
                            class="testimonial-card"
                            aria-hidden={isDuplicate ? "true" : undefined}
                        >
                            <article class="testimonial-card__inner">
                                <p class="testimonial-card__quote">
                                    “{testimonial.quote}”
                                </p>

                                <footer class="testimonial-card__footer">
                                    <div class="testimonial-card__author">
                                        <div
                                            class="testimonial-card__avatar"
                                            aria-hidden="true"
                                        >
                                            {testimonial.avatarKey ? (
                                                <img
                                                    src={avatarPath(testimonial.avatarKey, 96)}
                                                    srcset={avatarSrcSet(testimonial.avatarKey)}
                                                    sizes="36px"
                                                    width="36"
                                                    height="36"
                                                    alt=""
                                                    loading="lazy"
                                                    decoding="async"
                                                />
                                            ) : (
                                                initial
                                            )}
                                        </div>

                                        <div class="min-w-0">
                                            <p class="testimonial-card__name">
                                                {testimonial.name}
                                            </p>
                                            <p class="testimonial-card__title">
                                                {testimonial.title}
                                            </p>
                                        </div>
                                    </div>

                                    {logo && (
                                        <div class="testimonial-card__logo" aria-hidden="true">
                                            <svg
                                                viewBox={logo.viewBox}
                                                aria-hidden="true"
                                                focusable="false"
                                            >
                                                {logo.paths.map((path) => (
                                                    <path
                                                        d={path.d}
                                                        fill="currentColor"
                                                        fill-rule={
                                                            path.evenodd
                                                                ? "evenodd"
                                                                : undefined
                                                        }
                                                        clip-rule={
                                                            path.evenodd
                                                                ? "evenodd"
                                                                : undefined
                                                        }
                                                    />
                                                ))}
                                            </svg>
                                        </div>
                                    )}
                                </footer>
                            </article>
                        </li>
                    )
                })}
            </ul>
        </div>

        <ul class="home-testimonials__grid" role="list" aria-label="Testimonials">
            {TESTIMONIALS.map((testimonial) => {
                const logo = logoByName.get(testimonial.logoName)
                const initial = testimonial.name.trim().slice(0, 1).toUpperCase()

                return (
                    <li class="testimonial-card">
                        <article class="testimonial-card__inner">
                            <p class="testimonial-card__quote">
                                “{testimonial.quote}”
                            </p>

                            <footer class="testimonial-card__footer">
                                <div class="testimonial-card__author">
                                    <div class="testimonial-card__avatar" aria-hidden="true">
                                        {testimonial.avatarKey ? (
                                            <img
                                                src={avatarPath(testimonial.avatarKey, 96)}
                                                srcset={avatarSrcSet(testimonial.avatarKey)}
                                                sizes="36px"
                                                width="36"
                                                height="36"
                                                alt=""
                                                loading="lazy"
                                                decoding="async"
                                            />
                                        ) : (
                                            initial
                                        )}
                                    </div>

                                    <div class="min-w-0">
                                        <p class="testimonial-card__name">
                                            {testimonial.name}
                                        </p>
                                        <p class="testimonial-card__title">
                                            {testimonial.title}
                                        </p>
                                    </div>
                                </div>

                                {logo && (
                                    <div class="testimonial-card__logo" aria-hidden="true">
                                        <svg
                                            viewBox={logo.viewBox}
                                            aria-hidden="true"
                                            focusable="false"
                                        >
                                            {logo.paths.map((path) => (
                                                <path
                                                    d={path.d}
                                                    fill="currentColor"
                                                    fill-rule={
                                                        path.evenodd ? "evenodd" : undefined
                                                    }
                                                    clip-rule={
                                                        path.evenodd ? "evenodd" : undefined
                                                    }
                                                />
                                            ))}
                                        </svg>
                                    </div>
                                )}
                            </footer>
                        </article>
                    </li>
                )
            })}
        </ul>
    </div>
</section>

<style>
    .home-testimonials {
        padding: 64px 0 120px;
        scroll-margin-top: 80px;
        position: relative;
        z-index: 1;
    }

    .home-testimonials__header {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 16px;
        margin-bottom: 40px;
    }

    .home-testimonials__pill {
        margin: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 18px;
        border-radius: 9999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(0, 0, 0, 0.22);
        color: rgb(173, 173, 173);
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        letter-spacing: -0.01em;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .home-testimonials__title {
        margin: 0;
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 40px;
        font-weight: 400;
        line-height: 48px;
        letter-spacing: -0.8px;
        color: #ffffff;
        text-wrap: balance;
        max-width: 720px;
    }

    @media (max-width: 767px) {
        .home-testimonials__title {
            font-size: 32px;
            line-height: 40px;
        }
    }

    .home-testimonials__subtitle {
        margin: 0;
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        color: rgb(173, 173, 173);
        max-width: 520px;
        text-wrap: pretty;
    }

    .home-testimonials__ticker {
        width: 100%;
        overflow: hidden;
        mask-image: linear-gradient(
            to right,
            rgba(0, 0, 0, 0) 0%,
            rgb(0, 0, 0) 18%,
            rgb(0, 0, 0) 82%,
            rgba(0, 0, 0, 0) 100%
        );
        -webkit-mask-image: linear-gradient(
            to right,
            rgba(0, 0, 0, 0) 0%,
            rgb(0, 0, 0) 18%,
            rgb(0, 0, 0) 82%,
            rgba(0, 0, 0, 0) 100%
        );
    }

    .home-testimonials__track {
        display: flex;
        flex-direction: row;
        align-items: stretch;
        gap: 20px;
        width: max-content;
        margin: 0;
        padding: 8px 0 32px;
        list-style: none;
        will-change: transform;
        animation: testimonialsMarquee 55s linear infinite;
    }

    @media (hover: hover) {
        .home-testimonials__ticker:hover .home-testimonials__track {
            animation-play-state: paused;
        }
    }

    @keyframes testimonialsMarquee {
        0% {
            transform: translateX(0);
        }
        100% {
            transform: translateX(-50%);
        }
    }

    .home-testimonials__grid {
        display: none;
        margin: 0;
        padding: 0;
        list-style: none;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        justify-items: center;
    }

    @media (prefers-reduced-motion: reduce) {
        .home-testimonials__ticker {
            display: none;
        }

        .home-testimonials__grid {
            display: grid;
        }

        .home-testimonials__track {
            animation: none;
            transform: none;
        }
    }

    .testimonial-card {
        width: 384px;
        flex-shrink: 0;
    }

    @media (max-width: 639px) {
        .testimonial-card {
            width: 320px;
        }
    }

    @media (max-width: 389px) {
        .testimonial-card {
            width: 280px;
        }
    }

    .home-testimonials__grid .testimonial-card {
        width: 100%;
        max-width: 384px;
    }

    .testimonial-card__inner {
        height: 100%;
        border-radius: 16px;
        padding: 22px 22px 18px;
        position: relative;
        overflow: hidden;
        background: radial-gradient(
            111.294% 44% at 50% 0%,
            rgba(20, 20, 20, 0.85) 0%,
            rgba(0, 0, 0, 0.72) 80%
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.04);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 18px;
        transition: border-color 220ms ease, box-shadow 220ms ease,
            transform 220ms ease;
    }

    @media (hover: hover) {
        .testimonial-card__inner:hover {
            border-color: rgba(255, 255, 255, 0.14);
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.06),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            transform: translateY(-1px);
        }
    }

    .testimonial-card__quote {
        margin: 0;
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        font-size: 15px;
        font-weight: 400;
        line-height: 24px;
        letter-spacing: -0.01em;
        color: rgba(173, 173, 173, 1);
        text-wrap: pretty;
    }

    @media (hover: hover) {
        .testimonial-card__inner:hover .testimonial-card__quote {
            color: rgba(226, 226, 226, 1);
        }
    }

    .testimonial-card__footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding-top: 14px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .testimonial-card__author {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
    }

    .testimonial-card__avatar {
        width: 36px;
        height: 36px;
        border-radius: 9999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.86);
        font-size: 14px;
        font-weight: 600;
        letter-spacing: -0.01em;
        flex: none;
        overflow: hidden;
    }

    .testimonial-card__avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        display: block;
    }

    .testimonial-card__name {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
        line-height: 20px;
        letter-spacing: -0.01em;
        color: rgba(214, 215, 214, 1);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .testimonial-card__title {
        margin: 0;
        font-size: 13px;
        font-weight: 500;
        line-height: 18px;
        letter-spacing: -0.01em;
        color: rgba(144, 142, 142, 1);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .testimonial-card__logo {
        color: rgba(255, 255, 255, 0.75);
        opacity: 0.75;
        transition: opacity 220ms ease;
        flex: none;
    }

    .testimonial-card__logo svg {
        display: block;
        height: 18px;
        width: auto;
        max-width: 130px;
    }

    @media (hover: hover) {
        .testimonial-card__inner:hover .testimonial-card__logo {
            opacity: 1;
        }
    }
</style>
