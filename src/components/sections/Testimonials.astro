---
import { HOME_LOGOS, type HomeLogo } from "./logosData";
import TestimonialCard from "../ui/TestimonialCard.astro";

type Testimonial = {
    name: string;
    title: string;
    quote: string;
    logoName: HomeLogo["name"];
    avatarKey?: string;
};

const TESTIMONIALS: Testimonial[] = [
    {
        name: "Francesca T.",
        title: "Freelancer",
        quote: "Worth every penny. The time I save on email pays for Duet Mail 10x over. Can't imagine working without it now.",
        logoName: "Airtable",
        avatarKey: "francesca",
    },
    {
        name: "Michael R.",
        title: "Sales Executive",
        quote: "The instant summaries of long email threads are pure magic, and so user-friendly. My clients think I'm superhuman.",
        logoName: "Upwork",
        avatarKey: "michael",
    },
    {
        name: "Johnny S.",
        title: "Entrepreneur",
        quote: "Was skeptical of artificial intelligence use for my emails. Now, it's like having a brilliant executive assistant. Can't imagine going back.",
        logoName: "Fiverr",
        avatarKey: "johnny",
    },
    {
        name: "Jennifer L.",
        title: "Consultant",
        quote: "As a consultant, every minute counts. Duet Mail doesn't just save me timeâ€”it makes my email communication sharper.",
        logoName: "Ahrefs",
        avatarKey: "jennifer",
    },
    {
        name: "Sarah T.",
        title: "Marketing Director",
        quote: "Finally, an AI mail assistant that actually learns how I write. The instant replies are so spot-on, my team thought I was working at midnight.",
        logoName: "Wise",
        avatarKey: "sarah",
    },
];

const repeatedTestimonials = [...TESTIMONIALS, ...TESTIMONIALS];
const logoByName = new Map(
    HOME_LOGOS.map((logo) => [logo.name, logo] as const),
);
---

<section id="testimonials" class="home-testimonials" aria-label="Testimonials">
    <div class="mx-auto max-w-6xl px-6 md:px-10">
        <header class="home-testimonials__header">
            <p class="home-testimonials__pill">Testimonials</p>
            <h2 class="home-testimonials__title">
                Loved by busy professionals
            </h2>
            <p class="home-testimonials__subtitle">
                Real people. Real inbox wins.
            </p>
        </header>

        <div
            class="home-testimonials__ticker"
            aria-label="Scrolling testimonials"
        >
            <ul class="home-testimonials__track" role="list">
                {
                    repeatedTestimonials.map((testimonial, index) => {
                        const logo = logoByName.get(testimonial.logoName);
                        const isDuplicate = index >= TESTIMONIALS.length;

                        return (
                            <TestimonialCard
                                {testimonial}
                                {logo}
                                ariaHidden={isDuplicate}
                            />
                        );
                    })
                }
            </ul>
        </div>

        <ul
            class="home-testimonials__grid"
            role="list"
            aria-label="Testimonials"
        >
            {
                TESTIMONIALS.map((testimonial) => {
                    const logo = logoByName.get(testimonial.logoName);

                    return (
                        <TestimonialCard {testimonial} {logo} />
                    );
                })
            }
        </ul>
    </div>
</section>

<style>
    .home-testimonials {
        padding: 64px 0 120px;
        scroll-margin-top: 80px;
        position: relative;
        z-index: 1;
    }

    .home-testimonials__header {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 16px;
        margin-bottom: 40px;
    }

    .home-testimonials__pill {
        margin: 0;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 8px 18px;
        border-radius: 9999px;
        border: 1px solid var(--badge-border);
        background: var(--badge-bg);
        color: var(--badge-text);
        font-family:
            "Manrope Variable",
            ui-sans-serif,
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            Roboto,
            Helvetica,
            Arial,
            sans-serif;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        letter-spacing: -0.01em;
        box-shadow:
            0 10px 30px rgba(0, 0, 0, 0.35),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }

    .home-testimonials__title {
        margin: 0;
        font-family: var(--font-serif);
        font-size: 42px;
        font-weight: 500;
        line-height: 1.1;
        letter-spacing: -0.02em;
        color: var(--prose-heading);
        text-wrap: balance;
        max-width: 720px;
    }

    @media (max-width: 767px) {
        .home-testimonials__title {
            font-size: 32px;
        }
    }

    .home-testimonials__subtitle {
        margin: 0;
        font-family: var(--font-sans);
        font-size: 16px;
        font-weight: 400;
        line-height: 1.7;
        color: var(--prose-text);
        max-width: 520px;
        text-wrap: pretty;
    }

    .home-testimonials__ticker {
        width: 100%;
        overflow: hidden;
        mask-image: linear-gradient(
            to right,
            rgba(0, 0, 0, 0) 0%,
            rgb(0, 0, 0) 18%,
            rgb(0, 0, 0) 82%,
            rgba(0, 0, 0, 0) 100%
        );
        -webkit-mask-image: linear-gradient(
            to right,
            rgba(0, 0, 0, 0) 0%,
            rgb(0, 0, 0) 18%,
            rgb(0, 0, 0) 82%,
            rgba(0, 0, 0, 0) 100%
        );
    }

    .home-testimonials__track {
        display: flex;
        flex-direction: row;
        align-items: stretch;
        gap: 20px;
        width: max-content;
        margin: 0;
        padding: 24px 0 56px;
        list-style: none;
        will-change: transform;
        animation: testimonialsMarquee 55s linear infinite;
    }

    @media (hover: hover) {
        .home-testimonials__ticker:hover .home-testimonials__track {
            animation-play-state: paused;
        }
    }

    @keyframes testimonialsMarquee {
        0% {
            transform: translateX(0);
        }
        100% {
            transform: translateX(-50%);
        }
    }

    .home-testimonials__grid {
        display: none;
        margin: 0;
        padding: 0;
        list-style: none;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        justify-items: center;
    }

    @media (prefers-reduced-motion: reduce) {
        .home-testimonials__ticker {
            display: none;
        }

        .home-testimonials__grid {
            display: grid;
        }

        .home-testimonials__track {
            animation: none;
            transform: none;
        }
    }


</style>
