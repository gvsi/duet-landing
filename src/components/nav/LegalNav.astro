---
import ThemeToggle from "../ui/ThemeToggle.astro";

type ActivePage = "terms" | "privacy" | "cookies" | "disclaimer"

type Props = {
    active?: ActivePage
}

const { active } = Astro.props

const links: Array<{ key: ActivePage | "home"; label: string; href: string }> = [
    { key: "home", label: "Home", href: "/" },
    { key: "terms", label: "Terms", href: "/terms" },
    { key: "privacy", label: "Privacy", href: "/privacy" },
    { key: "cookies", label: "Cookies", href: "/cookies" },
    { key: "disclaimer", label: "Disclaimers", href: "/disclaimer" },
]
---

<header class="site-nav fixed inset-x-0 top-0 z-50 backdrop-blur-[8px]">
    <div class="site-nav__bar mx-auto flex max-w-6xl items-center justify-between px-6 md:px-10">
        <a href="/" class="flex items-center gap-2">
            <img
                src="/favicon.svg"
                width="27"
                height="27"
                class="h-[27px] w-[27px]"
                alt=""
                decoding="async"
            />
            <img
                src="/logo.svg"
                width="100"
                height="17"
                class="logo-dark h-[17px] w-auto"
                alt="Duet Mail"
                decoding="async"
            />
            <img
                src="/logo_light.svg"
                width="100"
                height="17"
                class="logo-light h-[17px] w-auto hidden"
                alt="Duet Mail"
                decoding="async"
            />
        </a>

        <nav class="hidden items-center gap-6 md:flex" aria-label="Legal navigation">
            {links.map((link) => (
                <a
                    class:list={[
                        "nav-link",
                        link.key !== "home" &&
                            active === link.key &&
                            "nav-link--active",
                    ]}
                    href={link.href}
                    aria-current={
                        link.key !== "home" && active === link.key
                            ? "page"
                            : undefined
                    }
                >
                    {link.label}
                </a>
            ))}
        </nav>

        <div class="flex items-center gap-3">
            <ThemeToggle />
            <details class="mobile-menu md:hidden" data-mobile-menu>
                <summary class="mobile-menu-trigger" aria-label="Open navigation menu">
                    <svg
                        class="mobile-menu-icon mobile-menu-icon--open"
                        width="20"
                        height="20"
                        viewBox="0 0 20 20"
                        fill="none"
                        aria-hidden="true"
                    >
                        <path
                            d="M3 5H17M3 10H17M3 15H17"
                            stroke="currentColor"
                            stroke-width="1.6"
                            stroke-linecap="round"
                        />
                    </svg>

                    <svg
                        class="mobile-menu-icon mobile-menu-icon--close"
                        width="20"
                        height="20"
                        viewBox="0 0 20 20"
                        fill="none"
                        aria-hidden="true"
                    >
                        <path
                            d="M5 5L15 15M15 5L5 15"
                            stroke="currentColor"
                            stroke-width="1.6"
                            stroke-linecap="round"
                        />
                    </svg>
                </summary>

                <nav class="mobile-menu-panel" aria-label="Mobile legal navigation">
                    {links.map((link) => (
                        <a
                            class:list={[
                                "mobile-menu-link",
                                link.key !== "home" &&
                                    active === link.key &&
                                    "mobile-menu-link--active",
                            ]}
                            href={link.href}
                            aria-current={
                                link.key !== "home" && active === link.key
                                    ? "page"
                                    : undefined
                            }
                        >
                            {link.label}
                        </a>
                    ))}
                </nav>
            </details>
        </div>
    </div>
</header>

<script is:inline>
    ;(() => {
        const menu = document.querySelector("details[data-mobile-menu]")
        if (!menu) return

        const summary = menu.querySelector("summary")
        const updateAriaLabel = () => {
            if (!summary) return
            summary.setAttribute(
                "aria-label",
                menu.hasAttribute("open")
                    ? "Close navigation menu"
                    : "Open navigation menu"
            )
        }

        const close = () => menu.removeAttribute("open")

        menu.addEventListener("toggle", updateAriaLabel)
        updateAriaLabel()

        document.addEventListener("click", (event) => {
            if (!menu.hasAttribute("open")) return
            const target = event.target
            if (!(target instanceof Node)) return

            if (menu.contains(target)) {
                if (target instanceof Element && target.closest("a")) close()
                return
            }

            close()
        })

        document.addEventListener("keydown", (event) => {
            if (event.key === "Escape") close()
        })
    })()
</script>

<style>
    /* Logo Theme Switching */
    :global(html[data-theme="light"]) .logo-dark {
        display: none;
    }
    :global(html[data-theme="light"]) .logo-light {
        display: block;
    }
</style>

<style>
    .site-nav {
        height: 72px;
        background: var(--nav-bg);
        transition: height 180ms ease, background-color 180ms ease;
    }

    .site-nav::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: 0;
        height: 1px;
        background: var(--nav-border);
    }

    .site-nav__bar {
        height: 72px;
    }

    @media (min-width: 768px) {
        .site-nav {
            height: 57px;
        }

        .site-nav__bar {
            height: 57px;
        }
    }

    @media (max-width: 767px) {
        .site-nav:has(details[data-mobile-menu][open]) {
            height: 378px;
            background: var(--nav-mobile-bg);
        }
    }

    .nav-link {
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
        font-size: 14px;
        font-weight: 500;
        letter-spacing: -0.01em;
        color: var(--nav-text);
        text-decoration: none;
        transition: color 0.2s ease;
    }

    .nav-link:hover {
        color: var(--nav-text-hover);
    }

    .nav-link--active {
        color: var(--nav-text-hover);
    }

    .mobile-menu > summary {
        list-style: none;
    }

    .mobile-menu > summary::-webkit-details-marker {
        display: none;
    }

    .mobile-menu-trigger {
        display: inline-flex;
        height: 40px;
        width: 40px;
        align-items: center;
        justify-content: center;
        border-radius: 9999px;
        color: var(--nav-text);
        cursor: pointer;
        user-select: none;
        transition: color 0.2s ease, background 0.2s ease;
    }

    .mobile-menu-trigger:hover {
        color: var(--nav-text-hover);
        background: rgba(255, 255, 255, 0.06);
    }

    :global(html[data-theme="light"]) .mobile-menu-trigger:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    .mobile-menu-trigger:focus-visible {
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.22);
    }

    :global(html[data-theme="light"]) .mobile-menu-trigger:focus-visible {
        box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.15);
    }

    .mobile-menu-panel {
        display: none;
        position: absolute;
        left: 0;
        right: 0;
        top: 82px;
        padding: 8px;
        gap: 8px;
        flex-direction: column;
    }

    .mobile-menu[open] .mobile-menu-panel {
        display: flex;
    }

    .mobile-menu-icon {
        display: block;
    }

    .mobile-menu-icon--close {
        display: none;
    }

    .mobile-menu[open] .mobile-menu-icon--open {
        display: none;
    }

    .mobile-menu[open] .mobile-menu-icon--close {
        display: block;
    }

    .mobile-menu-link {
        display: flex;
        align-items: center;
        height: 48px;
        padding: 0 16px;
        font-family: "Manrope Variable", ui-sans-serif, system-ui, -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
        font-size: 14px;
        font-weight: 500;
        line-height: 20px;
        color: var(--nav-text);
        text-decoration: none;
        border-radius: 10px;
        transition: background 0.15s ease, color 0.15s ease;
    }

    .mobile-menu-link:hover {
        background: rgba(255, 255, 255, 0.06);
        color: var(--nav-text-hover);
    }

    :global(html[data-theme="light"]) .mobile-menu-link:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    .mobile-menu-link--active {
        color: var(--nav-text-hover);
        background: rgba(255, 255, 255, 0.04);
    }

    :global(html[data-theme="light"]) .mobile-menu-link--active {
        background: rgba(0, 0, 0, 0.04);
    }
</style>
