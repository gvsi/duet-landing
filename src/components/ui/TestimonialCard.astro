---
import type { HomeLogo } from "../sections/logosData";

type Props = {
    testimonial: { name: string; title: string; quote: string; avatarKey?: string };
    logo?: HomeLogo;
    ariaHidden?: boolean;
};

const { testimonial, logo, ariaHidden } = Astro.props;

const avatarPath = (key: string, size: 64 | 96 | 128) =>
    `/avatars/testimonials/${key}-${size}.jpg`;

const avatarSrcSet = (key: string) =>
    `${avatarPath(key, 64)} 64w, ${avatarPath(key, 96)} 96w, ${avatarPath(
        key,
        128,
    )} 128w`;

const initial = testimonial.name.trim().slice(0, 1).toUpperCase();
---

<li
    class="testimonial-card"
    aria-hidden={ariaHidden ? "true" : undefined}
>
    <article class="testimonial-card__inner">
        <p class="testimonial-card__quote">
            "{testimonial.quote}"
        </p>

        <footer class="testimonial-card__footer">
            <div class="testimonial-card__author">
                <div
                    class="testimonial-card__avatar"
                    aria-hidden="true"
                >
                    {testimonial.avatarKey ? (
                        <img
                            src={avatarPath(
                                testimonial.avatarKey,
                                96,
                            )}
                            srcset={avatarSrcSet(
                                testimonial.avatarKey,
                            )}
                            sizes="36px"
                            width="36"
                            height="36"
                            alt=""
                            loading="lazy"
                            decoding="async"
                        />
                    ) : (
                        initial
                    )}
                </div>

                <div class="min-w-0">
                    <p class="testimonial-card__name">
                        {testimonial.name}
                    </p>
                    <p class="testimonial-card__title">
                        {testimonial.title}
                    </p>
                </div>
            </div>

            {logo && (
                <div
                    class="testimonial-card__logo"
                    aria-hidden="true"
                >
                    <svg
                        viewBox={logo.viewBox}
                        aria-hidden="true"
                        focusable="false"
                    >
                        {logo.paths.map((path) => (
                            <path
                                d={path.d}
                                fill="currentColor"
                                fill-rule={
                                    path.evenodd
                                        ? "evenodd"
                                        : undefined
                                }
                                clip-rule={
                                    path.evenodd
                                        ? "evenodd"
                                        : undefined
                                }
                            />
                        ))}
                    </svg>
                </div>
            )}
        </footer>
    </article>
</li>

<style>
    .testimonial-card {
        width: 384px;
        flex-shrink: 0;
    }

    @media (max-width: 639px) {
        .testimonial-card {
            width: 320px;
        }
    }

    @media (max-width: 389px) {
        .testimonial-card {
            width: 280px;
        }
    }

    :global(.home-testimonials__grid) .testimonial-card {
        width: 100%;
        max-width: 384px;
    }

    .testimonial-card__inner {
        height: 100%;
        border-radius: 16px;
        padding: 22px 22px 18px;
        position: relative;
        overflow: hidden;
        background: var(--mockup-window-bg);
        border: 1px solid var(--mockup-border);
        box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25), 0 8px 16px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        gap: 18px;
        transition:
            border-color 220ms ease,
            box-shadow 220ms ease,
            transform 220ms ease;
    }

    @media (hover: hover) {
        .testimonial-card__inner:hover {
            border-color: var(--prose-heading);
            transform: translateY(-1px);
        }

        .testimonial-card__inner:hover .testimonial-card__quote {
            color: var(--prose-heading);
        }

        .testimonial-card__inner:hover .testimonial-card__logo {
            opacity: 1;
            color: var(--prose-heading);
        }
    }

    .testimonial-card__quote {
        margin: 0;
        font-family:
            "Manrope Variable",
            ui-sans-serif,
            system-ui,
            -apple-system,
            BlinkMacSystemFont,
            "Segoe UI",
            Roboto,
            Helvetica,
            Arial,
            sans-serif;
        font-size: 15px;
        font-weight: 400;
        line-height: 24px;
        letter-spacing: -0.01em;
        color: var(--prose-text);
        text-wrap: pretty;
    }

    .testimonial-card__footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding-top: 14px;
        border-top: 1px solid var(--mockup-border);
    }

    .testimonial-card__author {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
    }

    .testimonial-card__avatar {
        width: 36px;
        height: 36px;
        border-radius: 9999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: var(--badge-bg);
        border: 1px solid var(--badge-border);
        color: var(--badge-text);
        font-size: 14px;
        font-weight: 600;
        letter-spacing: -0.01em;
        flex: none;
        overflow: hidden;
    }

    .testimonial-card__avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        display: block;
    }

    .testimonial-card__name {
        margin: 0;
        font-size: 14px;
        font-weight: 600;
        line-height: 20px;
        letter-spacing: -0.01em;
        color: var(--prose-heading);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .testimonial-card__title {
        margin: 0;
        font-size: 13px;
        font-weight: 500;
        line-height: 18px;
        letter-spacing: -0.01em;
        color: var(--duet-muted);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .testimonial-card__logo {
        color: var(--duet-muted);
        opacity: 0.8;
        filter: grayscale(100%);
        transition:
            opacity 220ms ease,
            color 220ms ease;
        flex: none;
    }

    .testimonial-card__logo svg {
        display: block;
        height: 18px;
        width: auto;
        max-width: 130px;
    }
</style>
